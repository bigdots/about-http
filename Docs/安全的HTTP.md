<!-- TOC -->

- [安全的HTTP](#安全的http)
    - [HTTP的缺陷](#http的缺陷)
    - [HTTPS](#https)
    - [SSL 和 TLS](#ssl-和-tls)
    - [加密技术](#加密技术)
    - [公开密钥证书](#公开密钥证书)

<!-- /TOC -->

# 安全的HTTP

## HTTP的缺陷
1. 通信使用明文(不加密)，内容可能会被窃听
    按照 TCP/IP 协议族的工作机制，通信内容在所有的通信线路上都有可能遭到窥视。而 HTTP 报文使用明文(指未经过加密的报文)方式发送，一旦遭到恶意窥视，信息就遭到了泄露。

    危机：
    + 数据包被窥视后，信息暴露

    解决：
    + 信息加密处理（包括通信加密和内容加密）

2. 不验证通信方的身份，因此有可能遭遇伪装
    HTTP 协议中的请求和响应不会对通信方进行确认。任何人都可以发起和接收请求。

    危机：
    + 被伪装的客户端或者服务器所欺骗
    + 无法验证访问权限，导致重要信息暴露
    + 所有请求照单全收，容易遭到DOS攻击(Denial of Service， 拒绝服务攻击)。

    解决：
    + 使用SSL协议查明对手的证书

3. 无法证明报文的完整性，所以有可能已遭篡改

    危机：
    + 客户端或服务端接收的内容有误

    解决：
    + MD5 和 SHA- 1 等散列值校验方法
    + 数字签名


## HTTPS

**HTTP+ 加密 + 认证 + 完整性保护 =HTTPS (HTTP Secure)**

> HTTPS 是身披 SSL 外壳的 HTTP

HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL(Secure Socket Layer)和TLS(Transport Layer Security)协议代替而已。

使用 HTTPS 时，HTTP会先和 SSL 通信，再由 SSL 和 TCP 通信。

SSL 是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配
合 SSL 协议使用。可以说 SSL 是当今世界上应用最为广泛的网络安全技术。

缺点：
比HTTP慢2～100倍。

+ 增加一层通信，通信慢。
+ 加解密大量消耗 CPU 及内存等资源，运算慢

解决：
合理使用，只针对敏感信息使用。

## SSL 和 TLS

HTTPS 使用 SSL(Secure Socket Layer) 和 TLS(Transport Layer Security)这两个协议。

## 加密技术

1. 共享密钥加密（对称密钥加密）方式

    加密和解密同用一个密钥。以这种方式加密时必须将密钥也发给对方。
    如何安全地发送密钥成为问题

2. 公开加密方式

    使用一对非对称的密钥。一把叫做私有密钥(private key)，另一把叫做公开密钥(public key)。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。


    使用时，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。

    问题：无法保证公开密钥的正确性，公开密钥可能会被攻击者替换掉。

3. 混合加密机制

    HTTPS 充分利用公开加密和共享密钥加密各自的优势，采用混合加密机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。即：在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段则使用共享密钥加密方式。

## 公开密钥证书

由数字证书认证机构(CA，Certificate Authority)和其相关机关颁发的公开密钥证书。

数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上。

业务流程：

+ 服务器的运营人员 向数字证书认证机构提出公开密钥的申请。
+ 数字证书认证机构在判明提出申请者的身份之后，对已申请的公开密钥做数字签名
+ 分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。

发送服务器公钥流程：

+ 服务器将 公开密钥 和 公钥证书 发送给客户端
+ 客户端使用数字证书认证机构的公开密钥，对公钥证书上的数字签名进行验证


证书可以验证俩个问题：

+ 服务器的公开密钥是否是真实有效的数字证书认证机构
+ 服务器的公开密钥是否值得信赖


问题：认证机关的公开密钥不一定能安全地转交给客户端。

解决：浏览器发布时直接在内部植入常用认证机关的公开密钥。
